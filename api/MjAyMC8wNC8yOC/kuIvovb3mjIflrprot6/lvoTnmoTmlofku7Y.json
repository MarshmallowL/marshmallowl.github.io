{"title":"下载指定路径的文件","date":"2020-04-28T00:24:03.000Z","date_formatted":{"ll":"Apr 28, 2020","L":"04/28/2020","MM-DD":"04-28"},"link":"2020/04/28/下载指定路径的文件","tags":["java"],"categories":["工具"],"updated":"2021-04-03T05:30:51.297Z","content":"<h2 id=\"下载指定路径的文件\">下载指定路径的文件<a title=\"#下载指定路径的文件\" href=\"#下载指定路径的文件\"></a></h2>\n<h3 id=\"java下载指定路径或classpath下的文件\">java下载指定路径或classPath下的文件<a title=\"#java下载指定路径或classpath下的文件\" href=\"#java下载指定路径或classpath下的文件\"></a></h3>\n<h4 id=\"1.通用工具类，下载传入的文件\">1.通用工具类，下载传入的文件<a title=\"#1.通用工具类，下载传入的文件\" href=\"#1.通用工具类，下载传入的文件\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ResponseEntity&lt;FileSystemResource&gt; <span class=\"title\">downloadFile</span><span class=\"params\">(File file)</span></span>&#123;</span><br><span class=\"line\">    ResponseEntity&lt;FileSystemResource&gt; response;</span><br><span class=\"line\">    String fileName = file.getName();</span><br><span class=\"line\">    HttpHeaders headers = <span class=\"keyword\">new</span> HttpHeaders();</span><br><span class=\"line\">    headers.add(<span class=\"string\">&quot;Cache-Control&quot;</span>,<span class=\"string\">&quot;no-cache,no-store,must-revalidate&quot;</span>);</span><br><span class=\"line\">    headers.add(<span class=\"string\">&quot;Content-Disposition&quot;</span>,<span class=\"string\">&quot;attachment;filename=&quot;</span></span><br><span class=\"line\">                + <span class=\"keyword\">new</span> String(fileName.getBytes(<span class=\"string\">&quot;gbk&quot;</span>),<span class=\"string\">&quot;iso8859-1&quot;</span>));</span><br><span class=\"line\">    headers.add(<span class=\"string\">&quot;Pragma&quot;</span>,<span class=\"string\">&quot;no-cache&quot;</span>);</span><br><span class=\"line\">    headers.add(<span class=\"string\">&quot;Expires&quot;</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    response = ResponseEntity.ok().headers(headers)</span><br><span class=\"line\">        .contentType(MediaType.ParseMediaType(<span class=\"string\">&quot;application/octet-stream&quot;</span>))</span><br><span class=\"line\">        .body(<span class=\"keyword\">new</span> FileSystemResource(file));</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> response;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2.获取指定路径下的文件\">2.获取指定路径下的文件<a title=\"#2.获取指定路径下的文件\" href=\"#2.获取指定路径下的文件\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ResponseEntity&lt;FileSystemResource&gt; <span class=\"title\">downloadFile</span><span class=\"params\">(String filePath)</span></span>&#123;</span><br><span class=\"line\">    File file = <span class=\"keyword\">new</span> File(filePath);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> downloadFile(file);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"3.获取resources下的文件\">3.获取resources下的文件<a title=\"#3.获取resources下的文件\" href=\"#3.获取resources下的文件\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ResponseEntity&lt;FileSystemResource&gt; <span class=\"title\">downloadClassPathFile</span><span class=\"params\">(String relativePath)</span></span>&#123;</span><br><span class=\"line\">    ClassPathResource classPathResource = <span class=\"keyword\">new</span> ClassPathResource(relativePath);</span><br><span class=\"line\">    File file = classPathResource.getFile();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> downloadFile(file);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"注意!!\">注意!!<a title=\"#注意!!\" href=\"#注意!!\"></a></h5>\n<blockquote>\n<p>maven会对resources下的文件进行打包，导致xlsx等文件损坏无法下载，需要添加maven插件过滤掉</p>\n<p>配置如下：</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-resources-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">nonFilteredFileExtensions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">nonFilteredFileExtension</span>&gt;</span>xlsx<span class=\"tag\">&lt;/<span class=\"name\">nonFilteredFileExtension</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">nonFilteredFileExtension</span>&gt;</span>xls<span class=\"tag\">&lt;/<span class=\"name\">nonFilteredFileExtension</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">nonFilteredFileExtensions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>utf-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","prev":{"title":"SQL执行计划","link":"2020/12/10/SQL执行计划"},"next":{"title":"rsync同步备份","link":"2020/03/26/rsync同步文件夹"},"plink":"https://marshmallowl.github.io/2020/04/28/下载指定路径的文件/","toc":[{"id":"下载指定路径的文件","title":"下载指定路径的文件","index":"1","children":[{"id":"java下载指定路径或classpath下的文件","title":"java下载指定路径或classPath下的文件","index":"1.1"}]}],"copyright":{"author":"liugs","link":"<a href=\"https://marshmallowl.github.io/2020/04/28/下载指定路径的文件/\" title=\"下载指定路径的文件\">https://marshmallowl.github.io/2020/04/28/下载指定路径的文件/</a>","license":"(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>)许可协议，转载请注明来源<a href=\"https://marshmallowl.github.io/\" rel=\"nofollow\" target=\"_blank\">liugs</a>！"}}